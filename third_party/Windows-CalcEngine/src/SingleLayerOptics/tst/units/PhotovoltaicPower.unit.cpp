#include <memory>
#include <gtest/gtest.h>

#include <memory>

#include "WCESingleLayerOptics.hpp"

class TestPhotovoltaicPower : public testing::Test
{
public:
static SingleLayerOptics::PVPowerPropertiesTable table()
    {
        return {{{0.002478752, 0.550933333, 0.5467},
                 {0.002605841, 0.552778333, 0.5467415},
                 {0.002739445, 0.554623333, 0.546772667},
                 {0.002879899, 0.556468333, 0.5467935},
                 {0.003027555, 0.558313333, 0.546804},
                 {0.003182781, 0.560158333, 0.546804167},
                 {0.003345965, 0.562003333, 0.546794},
                 {0.003517517, 0.563848333, 0.5467735},
                 {0.003697864, 0.565693333, 0.546742667},
                 {0.003887457, 0.567538333, 0.5467015},
                 {0.004086771, 0.569383333, 0.54665},
                 {0.004296305, 0.571228333, 0.546588167},
                 {0.004516581, 0.573073333, 0.546516},
                 {0.004748151, 0.574918333, 0.5464335},
                 {0.004991594, 0.576763333, 0.546340667},
                 {0.005247518, 0.578608333, 0.5462375},
                 {0.005516564, 0.580453333, 0.546124},
                 {0.005799405, 0.582298333, 0.546000167},
                 {0.006096747, 0.584143333, 0.545866},
                 {0.006409333, 0.585988333, 0.5457215},
                 {0.006737947, 0.587833333, 0.545566667},
                 {0.007083409, 0.589678333, 0.5454015},
                 {0.007446583, 0.591523333, 0.545226},
                 {0.007828378, 0.593368333, 0.545040167},
                 {0.008229747, 0.595213333, 0.544844},
                 {0.008651695, 0.597058333, 0.5446375},
                 {0.009095277, 0.598903333, 0.544420667},
                 {0.009561602, 0.600748333, 0.5441935},
                 {0.010051836, 0.602593333, 0.543956},
                 {0.010567204, 0.604438333, 0.543708167},
                 {0.011108997, 0.606283333, 0.54345},
                 {0.011678567, 0.608128333, 0.5431815},
                 {0.01227734, 0.609973333, 0.542902667},
                 {0.012906813, 0.611818333, 0.5426135},
                 {0.013568559, 0.613663333, 0.542314},
                 {0.014264234, 0.615508333, 0.542004167},
                 {0.014995577, 0.617353333, 0.541684},
                 {0.015764416, 0.619198333, 0.5413535},
                 {0.016572675, 0.621043333, 0.541012667},
                 {0.017422375, 0.622888333, 0.5406615},
                 {0.018315639, 0.624733333, 0.5403},
                 {0.019254702, 0.626578333, 0.539928167},
                 {0.020241911, 0.628423333, 0.539546},
                 {0.021279736, 0.630268333, 0.5391535},
                 {0.022370772, 0.632113333, 0.538750667},
                 {0.023517746, 0.633958333, 0.5383375},
                 {0.024723526, 0.635803333, 0.537914},
                 {0.025991129, 0.637648333, 0.537480167},
                 {0.027323722, 0.639493333, 0.537036},
                 {0.02872464, 0.641338333, 0.5365815},
                 {0.030197383, 0.643183333, 0.536116667},
                 {0.031745636, 0.645028333, 0.5356415},
                 {0.03337327, 0.646873333, 0.535156},
                 {0.035084354, 0.648718333, 0.534660167},
                 {0.036883167, 0.650563333, 0.534154},
                 {0.038774208, 0.652408333, 0.5336375},
                 {0.040762204, 0.654253333, 0.533110667},
                 {0.042852127, 0.656098333, 0.5325735},
                 {0.045049202, 0.657943333, 0.532026},
                 {0.047358924, 0.659788333, 0.531468167},
                 {0.049787068, 0.661633333, 0.5309},
                 {0.052339706, 0.663478333, 0.5303215},
                 {0.05502322, 0.665323333, 0.529732667},
                 {0.057844321, 0.667168333, 0.5291335},
                 {0.060810063, 0.669013333, 0.528524},
                 {0.063927861, 0.670858333, 0.527904167},
                 {0.067205513, 0.672703333, 0.527274},
                 {0.070651213, 0.674548333, 0.5266335},
                 {0.074273578, 0.676393333, 0.525982667},
                 {0.078081666, 0.678238333, 0.5253215},
                 {0.082084999, 0.680083333, 0.52465},
                 {0.086293586, 0.681928333, 0.523968167},
                 {0.090717953, 0.683773333, 0.523276},
                 {0.095369162, 0.685618333, 0.5225735},
                 {0.100258844, 0.687463333, 0.521860667},
                 {0.105399225, 0.689308333, 0.5211375},
                 {0.110803158, 0.691153333, 0.520404},
                 {0.116484158, 0.692998333, 0.519660167},
                 {0.122456428, 0.694843333, 0.518906},
                 {0.128734904, 0.696688333, 0.5181415},
                 {0.135335283, 0.698533333, 0.517366667},
                 {0.142274072, 0.700378333, 0.5165815},
                 {0.149568619, 0.702223333, 0.515786},
                 {0.157237166, 0.704068333, 0.514980167},
                 {0.165298888, 0.705913333, 0.514164},
                 {0.173773943, 0.707758333, 0.5133375},
                 {0.182683524, 0.709603333, 0.512500667},
                 {0.192049909, 0.711448333, 0.5116535},
                 {0.201896518, 0.713293333, 0.510796},
                 {0.212247974, 0.715138333, 0.509928167},
                 {0.22313016, 0.716983333, 0.50905},
                 {0.234570288, 0.718828333, 0.5081615},
                 {0.246596964, 0.720673333, 0.507262667},
                 {0.259240261, 0.722518333, 0.5063535},
                 {0.272531793, 0.724363333, 0.505434},
                 {0.286504797, 0.726208333, 0.504504167},
                 {0.301194212, 0.728053333, 0.503564},
                 {0.316636769, 0.729898333, 0.5026135},
                 {0.332871084, 0.731743333, 0.501652667},
                 {0.349937749, 0.733588333, 0.5006815},
                 {0.367879441, 0.735433333, 0.4997},
                 {0.386741023, 0.737278333, 0.498708167},
                 {0.40656966, 0.739123333, 0.497706},
                 {0.427414932, 0.740968333, 0.4966935},
                 {0.449328964, 0.742813333, 0.495670667},
                 {0.472366553, 0.744658333, 0.4946375},
                 {0.496585304, 0.746503333, 0.493594},
                 {0.522045777, 0.748348333, 0.492540167},
                 {0.548811636, 0.750193333, 0.491476},
                 {0.57694981, 0.752038333, 0.4904015},
                 {0.60653066, 0.753883333, 0.489316667},
                 {0.637628152, 0.755728333, 0.4882215},
                 {0.670320046, 0.757573333, 0.487116},
                 {0.70468809, 0.759418333, 0.486000167},
                 {0.740818221, 0.761263333, 0.484874},
                 {0.778800783, 0.763108333, 0.4837375},
                 {0.818730753, 0.764953333, 0.482590667},
                 {0.860707976, 0.766798333, 0.4814335},
                 {0.904837418, 0.768643333, 0.480266},
                 {0.951229425, 0.770488333, 0.479088167},
                 {1, 0.772333333, 0.4779},
                 {1.051271096, 0.774178333, 0.4767015},
                 {1.105170918, 0.776023333, 0.475492667},
                 {1.161834243, 0.777868333, 0.4742735},
                 {1.221402758, 0.779713333, 0.473044},
                 {1.284025417, 0.781558333, 0.471804167},
                 {1.349858808, 0.783403333, 0.470554},
                 {1.419067549, 0.785248333, 0.4692935},
                 {1.491824698, 0.787093333, 0.468022667},
                 {1.568312185, 0.788938333, 0.4667415},
                 {1.648721271, 0.790783333, 0.46545},
                 {1.733253018, 0.792628333, 0.464148167},
                 {1.8221188, 0.794473333, 0.462836},
                 {1.915540829, 0.796318333, 0.4615135},
                 {2.013752707, 0.798163333, 0.460180667},
                 {2.117000017, 0.800008333, 0.4588375},
                 {2.225540928, 0.801853333, 0.457484},
                 {2.339646852, 0.803698333, 0.456120167},
                 {2.459603111, 0.805543333, 0.454746},
                 {2.585709659, 0.807388333, 0.4533615},
                 {2.718281828, 0.809233333, 0.451966667},
                 {2.857651118, 0.811078333, 0.4505615},
                 {3.004166024, 0.812923333, 0.449146},
                 {3.15819291, 0.814768333, 0.447720167},
                 {3.320116923, 0.816613333, 0.446284},
                 {3.490342957, 0.818458333, 0.4448375},
                 {3.669296668, 0.820303333, 0.443380667},
                 {3.857425531, 0.822148333, 0.4419135},
                 {4.055199967, 0.823993333, 0.440436},
                 {4.263114515, 0.825838333, 0.438948167},
                 {4.48168907, 0.827683333, 0.43745},
                 {4.711470183, 0.829528333, 0.4359415},
                 {4.953032424, 0.831373333, 0.434422667},
                 {5.206979827, 0.833218333, 0.4328935},
                 {5.473947392, 0.835063333, 0.431354},
                 {5.754602676, 0.836908333, 0.429804167},
                 {6.049647464, 0.838753333, 0.428244},
                 {6.359819523, 0.840598333, 0.4266735},
                 {6.685894442, 0.842443333, 0.425092667},
                 {7.028687581, 0.844288333, 0.4235015},
                 {7.389056099, 0.846133333, 0.4219}}};
    }
protected:
    virtual void SetUp()
    {}
};

TEST_F(TestPhotovoltaicPower, Test1)
{
    SCOPED_TRACE("Begin Test: Photovoltaic power table.");

    SingleLayerOptics::PVPowerPropertiesTable aTable{table()};

    const auto electricity{28.44044208};
    const auto voc{aTable.voc(electricity)};
    const auto ff{aTable.ff(electricity)};

    EXPECT_NEAR(0.810898202, voc, 1e-6);
    EXPECT_NEAR(0.450698689, ff, 1e-6);
}
