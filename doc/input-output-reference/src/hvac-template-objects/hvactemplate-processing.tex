\section{HVACTemplate Processing}\label{hvactemplate-processing}

\textbf{Unlike other EnergyPlus objects, the HVACTemplate objects are not handled by EnergyPlus directly.} Instead, they are preprocessed by a program called ExpandObjects or pyExpandObjects. If you use EP-Launch or RunEPlus.bat, this preprocessor step is performed automatically using the following sequence:

\subsection{Overview}

\subsubsection*{IDF Files}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  The preprocessor program, ExpandObjects, reads your IDF file and converts all of the HVACTemplate objects into other EnergyPlus objects.
\item
  The ExpandObjects program copies the original idf file with the HVACTemplate objects commented out (i.e., inserts a ``!'' in front of the object name and its input fields) plus all of the new objects created in Step 1 and writes a new file which is saved with the extension ``expidf''. This ``expidf'' file may be used as a standard EnergyPlus IDF file if the extension is changed to idf; however, for safety's sake, both filename and extension should be changed.
\item
  The EnergyPlus simulation proceeds using the expidf file as the input stream.
\item
  If there are error messages from EnergyPlus, they will refer to the contents of the expidf file. Specific objects referred to in error messages may exist in the original idf, but they may be objects created by ExpandObjects and only exist in the expidf. Remember that the expidf will be overwritten everytime the original idf is run using EP-Launch or RunEPlus.bat.
\end{enumerate}

\subsubsection*{epJSON Files}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  The preprocessor program, pyExpandObjects, reads your epJSON file, verifies it meets the current schema requirements, and converts all the HVACTemplate objects into other EnergyPlus objects.
\item
  The pyExpandObjects program writes one to three new files.  
  \begin{enumerate}
  \item
    A renamed file with the naming format "<original-file-name>\_expanded.epJSON". This “expanded” file may be used as a standard EnergyPlus epJSON file.  Note, the HVACTemplate objects will be completely removed from the expanded file, so ensure to save a copy of the original file before deleting anything!
  \item
    Optional - A file with the name "<original-file-name>\_hvac\_templates.epJSON" which has all the HVACTemplate objects from the input file.
  \item
    Optional - A file with the name "<original-file-name>\_base.epJSON" which has all the HVACTemplate objects removed.
  \end{enumerate}
  \item
    The EnergyPlus simulation proceeds using the expanded file as the input stream.
  \item
    If there are error messages from EnergyPlus, they will refer to the contents of the expanded file. Specific objects referred to in error messages may exist in the original epJSON, but they may be objects created by pyExpandObjects and only exist in the expanded file. Remember that the "<original-file-name>\_expanded.epJSON", "<original-file-name>\_hvac\_templates.epJSON", and "<original-file-name>\_base.epJSON" files will be overwritten everytime the original epJSON is run using EP-Launch or RunEPlus.bat.  Also note, the "<original-file-name>\_hvac\_templates.epJSON" and "<original-file-name>\_base.epJSON" files can be merged to recreate the original epJSON file.
\end{enumerate}

If you are trying to go beyond the capabilities of the HVACTemplate objects, one strategy you can use is to start your specification using the HVACTemplate objects, run EnergyPlus using EP-Launch and producing an expidf or epJSON file, rename that file and start making modifications. This approach may help with getting all of the objects needed and the node names set consistently.

\textbf{Users need to remember that no objects related to HVAC except for HVAC template objects are needed in the idf/epJSON file.} The existence of other objects (unless specifically described in the following sections) may cause unexpected errors to occur. \hyperref[sizingzone]{Sizing:Zone}, \hyperref[sizingsystem]{Sizing:System}, and \hyperref[sizingplant]{Sizing:Plant} objects will be generated by the corresponding HVACTemplate objects; the user does not need to create these elsewhere in the input file.

There are some exceptions to this rule:

\begin{itemize}
\item
  \hyperref[hvactemplateplantchillerobjectreference]{HVACTemplate:Plant:Chiller:ObjectReference} which requires that the corresponding chiller object be present in the idf/epJSON file along with any required curve or performance objects. In this case, the HVACTemplate object does not create the chiller object, but adds all of the connections. \hyperref[hvactemplateplanttowerobjectreference]{HVACTemplate:Plant:Tower:ObjectReference} and \hyperref[hvactemplateplantboiler]{HVACTemplate:Plant:Boiler};ObjectReferences are similar.
\item
  For HVACTemplate:Zone:* objects, if Outdoor Air Method = \emph{DetailedSpecification}, then any referenced \hyperref[designspecificationoutdoorair]{DesignSpecification:OutdoorAir} and \hyperref[designspecificationzoneairdistribution]{DesignSpecification:ZoneAirDistribution} objects must be present in the idf/epJSON file.
\item
  For \hyperref[hvactemplatezonevav]{HVACTemplate:Zone:VAV} and \hyperref[hvactemplatezonedualduct]{HVACTemplate:Zone:DualDuct}, if a Design Specification Outdoor Air Object Name for Control is specified, then the referenced \hyperref[designspecificationoutdoorair]{DesignSpecification:OutdoorAir} object must be present in the idf/epJSON file.
\end{itemize}

\subsection{Command Line Interface}

\subsubsection{Simulation Tool}

The command line interface located in the EnergyPlus root directory (energyplus.exe) provides optional arguments to enable various features of the simulation package.  Below are the options relating to the ExpandObjects and pyExpandObjects processes.

\subsubsection*{IDF Options}

\begin{itemize}
\item
  -x --expandobjects : Run ExpandObjects prior to simulation
\end{itemize}

\subsubsection*{epJSON Options}\label{pyexpandobjects-cli-epjson-options}

\begin{itemize}
\item
  -nb --no\_backup : Do no create backup files
  
  It is not possible to comment sections of code in JSON formatted files.  Therefore, the output expanded files do not have the ability to retain the HVACTemplate objects used to create the current document.  If the original file were to be overwritten, then all template data would be lost.  In an attempt to provide and additional layer of backups, the -nb option is set to False by default which means two files will be created: one with HVACTemplate objects, and one with all other objects.  With these files, the original input file can be created, or specific objects can be copied and pasted.
\item
  -ns --no\_schema : Skip schema validation checks for pyExpandObjects.  Note, this does not skip other schema validation operations within EnergyPlus itself.
  
  One benefit of the JSON file format is that files can be validated before simulation.  This means that erroneous inputs can be found before simulation, which saves time debugging output files and reading through logs, unsure of the error source.  This includes syntax errors, values that are out of range, and missing required inputs.  However, situations may occur when the user wishes to skip schema validation, in which case this flag should be used.  By default, schema validation is enabled.
  
\item
  -l --logger\_level : Set logging output level 
  
  Various levels of logging output are available for debugging, and other, purposes.  A valid level, consistent with Python logging naming structure (i.e. DEBUG, INFO, WARNING, ERROR, CRITICAL), must be provided.

\end{itemize}

\subsubsection{HVACTemplate Expansion Tools}

\subsubsection*{IDF - ExpandObjects}

No command line options are available for this tool.

\subsubsection*{epJSON - pyExpandObjects}

The command line options noted above in section~\ref{pyexpandobjects-cli-epjson-options} for epJSON files are available in this tool (e.g. -nb, -ns).  Additionally, the following arugment can be used to specify the file.  Values passed to the program with no arguments will be assumed to be a file name.

\begin{itemize}

\item
  -f --file FILE\_NAME : Specify file to expand
  
\end{itemize}
